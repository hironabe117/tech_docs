## 認証周りのコマンド
```bash
# 設定
aws configure
# 確認
aws configure list
```
## profileの定義
`~/.aws/config`にてプロファイルを定義する。
```properties
[default]
region = ap-northeast-1

[profile assume-only]
region = ap-northeast-1

[profile assume-role]
role_arn = arn:aws:iam::[スイッチ先アカウントID]:role/[スイッチ先ロール名]
mfa_serial = arn:aws:iam::[スイッチ元アカウントID]:mfa/[スイッチ元デバイス名]
source_profile = assume-only
region = ap-northeast-1
output = json
```

`~/.aws/credentials`にて使用するアクセスキーとシークレットキーを指定する。
```properties   
[default]

[assume-only]
aws_access_key_id = AKIAXXXX
aws_secret_access_key =　XXX
```

## profileの切り替え
プロファイルを環境変数に設定し、CLI実行時に`--profile`で指定する。
```bash
aws s3 ls --profile assume-role

# 現在のSTSが生きているか確認。InvalidTokenが出るなら切れている。
aws sts get-caller-identity

# 現在のセッションを確認
Get-ChildItem Env:AWS_SESSION_TOKEN

# 現在のセッションを削除
Remove-Item Env:AWS_SESSION_TOKEN -ErrorAction SilentlyContinue
```

## 確認コマンド
下記のようなコマンドを用いて、現在のプロファイルの権限で何が実行できるか確認する。
```bash
aws ec2 describe-instances
aws s3 ls
```

## AWSume
試してみる。

## 参考
- [まだPCにIAMアクセスキー保存してるの？ ベスプラに沿って、AWS CLIやSDKから安全に開発しよう！](https://qiita.com/minorun365/items/d504c73014056ea5a485)
- [マネコン起動もできるAWSのスイッチロール用CLIツール「AWSume」の紹介](https://dev.classmethod.jp/articles/awsume/)
